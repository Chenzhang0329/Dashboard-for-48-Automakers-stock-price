---
title: "Stock Price Dashboard Project"
author: "Chen Zhang"
date: '2022-12-10'
output:
  pdf_document: default
  html_document:
    df_print: paged
---
# Abstract    
  This research project analyzes and visualizes the stock price of 48 automaker companies around the world during the last decade. At this time, the proportion of automakers producing electric and CNG vehicles is increasing. Whether these automakers' stock prices are higher or even more stable than those that only make petrol cars is a question worth exploring.  

  Incorporating evidence from reviews, and stock price data, this study will discover which automakers are the top 1 around each country, which is the top 1 around each continent, and which is the top 1 global. It will argue the difference between the stock price of companies that make petrol cars only and the stock price of those companies that also make electric and CNG vehicles. Also, it will predict the stock price of those automakers in the future.  

# Introduction
  In the 2021 United Nations Climate Change Conference, there is an ambition for a 100% share of ZEVs in a new car and van sales by 2040 globally, and by 2035 in "leading markets”. Signatories include Austria, Canada, Ghana, and other countries. For now, more automakers have started to produce zero-emission vehicles in response to COP26's plan. In order to respond to the call of the United Nations, more and more car companies are producing ZEVs. Some people will start to wonder whether such behavior will affect the direction of the company's stock price. In order to visualize the stock price of each automaker in the last decade, we created this dashboard. Our dashboard mainly has the following functions, analyzing historical stock price trends, how some policies affect the company's stock price, and comparisons between different companies.  
  
  The data we used is founded in Kaggle, called “Top 48 automakers' daily stock price from 2010 to 2022”. There are two data sets we will use, first one gives all the information about those 48
automakers, like name, symbol, market capitalization, price, and country. We also add two columns which are 'Continents' and 'History' by manually searching on Google.
The other data set provides all the daily stock price data starting from 2009/12/31 to 2022/02/08, which includes the adjusted close price, close price, open price, high price, low price, and volume for every automaker. Most of the variables in these data sets are numerical variables, but there are only a few variables that are categorical variables like names, symbols, market capitalization, and so on.
  
  
# Methodology     
  In order to give users a better experience and adapt to stock price analysis, our dashboard will include some new charts. We will also use a model specific to the time series data to give a basic forecast about the daily closing price of the stock. So before we go through our dashboard, we will give some basic introduction of the candlestick chart and ARIMA model.   
  
## Candlestick Chart  
  The candlestick chart is a style of financial chart used to describe price movements of a security, derivative, or currency. It is similar to a bar chart in that each candlestick represents all four important pieces of information for that day: open and close in the thick body; high and low in the “candle wick”. Candlestick charts are most often used in technical analysis of equity and currency price patterns. For our dashboard, we created candlestick chart for all the companies to give some basic view of the history stock price. 
  
## ARIMA Model  
  ARIMA is an acronym for the AutoRegressive Integrated Moving Average model. ARIMA combined differencing with autoregression and a moving average model and usually, we will obtain a non-seasonal ARIMA model. For the seasonal time series data, we can apply SARIMA. The full model of ARIMA model can be written as
$$y'(t)=c+\phi_1y'_{t-1}+...+\phi_py'_{t-p}+\theta_1\epsilon_{t-1}+...+\theta_q\epsilon_{t-q}+\epsilon_t$$  

  ARIMA models are applied in some cases where data show evidence of non-stationarity in the sense of mean, where an initial differencing step can be applied once or more times to eliminate the non-stationarity of the mean function. For our dashboard, there were 48 companies and some of them are stationary time series but some of them are not. So we will use 'auto.arima' function to fit the best ARIMA model for different companies according to either AIC, AICc, or BIC value.


# Dicussion  
  Our dashboard will have 4 different sections, statistical overview, stock price analysis, comparison analysis, and stock price forecasting. In our report, we are going to give one example for each of sections to explain the purpose of our dashboard.

## Statistical Overview  
  In the statistical overview section, we created a indicator called 'Different Continents' and we also created a tab containing an overview and summary section. Combining the indicator and the tab, we provided a table of information for all the automakers in selected continents, and a table of how many automakers in each country in selected continents.  For the overview section, we can find out which automaker is the top 1 company in a particular continent. We also provided the bar plot based on the table in the overview tab section. The following bar chart is an example of when we selected 'Europe' as an indicator. We can get the top 1 automaker in Europe is Volkswagen which is a German company with a market capitalization of 124.3 billion. If we are familiar with those companies, we would find out that the top 3 companies in Europe are all from German. 
```{r echo=FALSE, fig.height=3.5, fig.width=11, message=FALSE, warning=FALSE, paged.print=FALSE}
library(ggplot2)
library(dplyr)
automakers_data = read.csv('./Final project data/Largest automakers by market capitalization.csv')
stock_price = read.csv('./Final project data/automakers stocks 2010-2022.csv')
automakers_data %>%
      filter(Continents  == 'Europe') %>%
      ggplot(aes(x = reorder(Name, -marketcap), y = marketcap)) + 
      geom_bar(stat = 'identity') + labs(x = 'Company') + theme_bw() 
```   

  In the summary section, we can find out which country has the most automakers in the selected continents with the corresponding proportion of them. In order to see the difference within the countries, we created a pie chart. If we looked at the same example of 'Europe', the pie chart on the next page can show us that German has the most automakers as a proportion of 40%. It totally makes sense, because people all know that Germany is famous for its manufacturing. They have lots of fantastic automakers such as Volkswagen, Daimler, BMW, and so on.  For those people who are not familiar with the stock market but planning to stock, they may want to try German automakers first.  
```{r echo=FALSE, fig.height=2, fig.width=2, message=FALSE, warning=FALSE, fig.align='center'}
library(plotly)
library(webshot2)
sum_table <- automakers_data %>%
      dplyr::filter(Continents  == 'Europe') %>%
      group_by(country) %>%
      dplyr::summarise(Number = n()) %>%
      arrange(desc(Number))
    
fig <- plot_ly(sum_table, labels = ~country, values = ~Number, type = 'pie')
htmlwidgets::saveWidget(widget = fig, file = "hc.html")
webshot(url = "hc.html", file = "hc.png", delay = 1, zoom = 4, vheight = 300)
```
  

  
## Stock Price Analysis  
  In the stock price analysis section, our main purpose is to show the historical trend of the stock price for the selected company. We know that the stock price is really sensitive, it can be affected by some policies or the behavior of some celebrities. So we also created a text box output to show some important events for the company. In order to help someone professional in fiance, we created the candlestick plot that we mentioned in the methodology. We also change the color of bullish and bearish to green and gray from the classic pair of colors. So for our plot, grey represent bearish and green means bullish. Below the main plot, there is a subplot which is a bar plot of the volume of the stock of each particular date. For some companies, an analysis of all the stock prices for the last decade may not be a good idea. So we also created a sidebar called date range which can let users select the start date and end date they want to analyze.  
  
  Let's look at an example if we select 'TSLA' as our interested company. We can get the following candlestick plot, we can see that the price was almost zero before 2013, and the volume was also zero. There was not a really huge increase until march 2020. After then, the stock price of Tesla rises steadily until 2021, which might be because after United Nations Climate Change Conference made that ambitious, more companies started to make ZEVs, then the stock price of Tesla was affected a little bit. Even for the volume, we can see that from 2020 to 2021, their volume is stable above 100 million.  

```{r echo=FALSE, fig.height=3, fig.width=12, message=FALSE, warning=FALSE}
data <- stock_price %>%
      filter(Symbol  == 'TSLA')
    
# colors column for increasing and decreasing
for (i in 1:length(data[,1])) {
  if (data$Close[i] >= data$Open[i]) {
      data$direction[i] <- 'Increasing'
    } else {
      data$direction[i] <- 'Decreasing'
    }
  }
    
i <- list(line = list(color = '#17BECF'))
d <- list(line = list(color = '#7F7F7F'))
    
    # plot candlestick chart
    
fig <- data %>% plot_ly(x = ~Date, type="candlestick",
                          open = ~Open, close = ~Close,
                          high = ~High, low = ~Low, name = 'TSLA',
                          increasing = i, decreasing = d)
fig <- fig %>% layout(yaxis = list(title = "Price"))
    
    # plot volume bar chart
fig2 <- data %>% plot_ly(x=~Date, y=~Volume, type='bar',
                             color = ~direction, colors = c('#17BECF','#7F7F7F')) 
fig2 <- fig2 %>% layout(yaxis = list(title = "Volume"))
    
    # subplot with shared x axis
fig <- subplot(fig, fig2, heights = c(0.7,0.2), nrows=2,
                   shareX = TRUE, titleY = TRUE)
fig <- fig %>% layout(legend = list(orientation = 'h', x = 0.5, y = 1,
                                        xanchor = 'center', yref = 'paper',
                                        font = list(size = 10),
                                        bgcolor = 'transparent'))
htmlwidgets::saveWidget(widget = fig, file = "hc.html")
webshot(url = "hc.html", file = "hc.png", delay = 1, zoom = 4, vheight = 300)
```


## Comparison Analysis  
  In the comparison analysis section, we create a page that can provide a table of stock price information for selected companies on the selected date. Since we thought, even though some policies may affect the stock price. But it may have different influence for different companys, so maybe they can overview any companies they want is a best way for investors. Also, then can select which price they want to analysis. The line chart below the table will provide the selected price of all selected companies, which we thought can help to do the analysis.  
  
  For example, we can go through the following table to look at the stock information of few companies such as 'TSLA', 'BMW.DE', 'RACE', and 'VOW3.DE' on 2021-11-01, which was the United Nations Climate Change Conference held. And it is obviously that 'TSLA' has the largest volume on that day, maybe more people think the ZEVs' company are more valuable after the conference.   

| **Symbol**       | **Adj.Close**    | **Close**    | **Open**    | **High**    | **Low** | **Volume** |
| -----------: |-----:| -----:| -----:| -----:| -----:| -----:|
| *TSLA* | 1208.59 | 1208.59 | 1145.00 | 1209.75 | 1118.66 | 56048700 |
| *BMW.DE* | 88.28 | 88.28 | 87.46 | 88.80 | 87.40 | 968616 |
| *RACE* | 239.74 | 239.74 | 241.35 | 244.12 | 238.90 | 834500 |
| *VOW3.DE* | 194.66 | 194.66 | 194.76 | 196.02 | 193.00 | 676132 |
## Stock Price Forecasting  
  In our stock price forecasting section, we can not provide the exact stock price of the date the user wants to look at. Since we have 48 different companies, we could not apply the same model to do the forecasting. Instead of that, we will let users make a choice, on how many days they want to forecast in the future. Based on that, we can give some basic trends of the stock price in the future. We will also provide the prediction interval of our forecasting value, cause again we knew that the stock market is sensitive and we can not predict it just by using historical data. 

  The following line chart shows the predicted value of the TSLA in the next 50 days. We can see that the predicted value will keep increasing steadily in the next 50 days. There were two different prediction intervals shown in the plot with the colors dark blue and light blue. The dark blue prediction interval is the 80% prediction interval, and the light blue one is the 95% prediction interval. 
  
```{r fig.height=3.5, fig.width=12, message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}
library(forecast)
library(quantmod)
BMW <- stock_price %>% 
      filter(Symbol == 'TSLA') %>%
      select('Date', 'Close')
    
BMW$Date <- as.Date(BMW$Date, "%d/%m/%Y")
tsData <- ts(BMW)
fit<-forecast::auto.arima(BMW$Close,trace=TRUE)
```
```{r echo=FALSE, fig.height=4, fig.width=12, message=FALSE, warning=FALSE}
autoplot(forecast(fit,50)) + xlab("Time") + ylab("Close")
```


# Conclusion  
  
